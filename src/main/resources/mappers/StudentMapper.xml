<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.ncre_system_idea.DAO.StudentDAO">
    <insert id="addOne">
        insert into student values (null,#{name},#{gender},#{age},#{phoneNumber},#{email},#{examID},
                                    #{examRoomID},#{seatID},#{username})
    </insert>
    <insert id="registerOne">
        insert into student values (null,#{name},#{gender},#{age},#{phoneNumber},#{email},null,
                                    null,null,#{username})
    </insert>
    <update id="update">
        update student set
                           Name = #{name},Gender=#{gender},Age=#{age},PhoneNumber=#{phoneNumber},Email=#{email},ExamID=#{examID},
                           ExamRoomID=#{examRoomID},SeatID=#{seatID}
        where StudentID=#{studentID}
    </update>
    <update id="updateAssignSeat">
        UPDATE student
        SET ExamRoomID = #{examRoomID}, SeatID = #{seatID}
        WHERE ExamID=#{examID} AND ExamRoomID IS NULL AND SeatID IS NULL
        LIMIT 1;
    </update>
    <update id="updateStudent">
        update student set
                           Name = #{name},Gender=#{gender},Age=#{age},PhoneNumber=#{phoneNumber},Email=#{email}
        where StudentID=#{studentID}
    </update>
    <update id="signUpExam">
        update student set
                           ExamID=#{examID}
        where username=#{username}
    </update>
    <delete id="deleteOne">
        delete from student where StudentID=#{studentID}
    </delete>
    <select id="selectAll" resultType="com.example.ncre_system_idea.pojo.Student">
        select * from student
    </select>
    <select id="selectAllById" resultType="com.example.ncre_system_idea.pojo.Student">
        select * from student where StudentID=#{id}
    </select>
    <select id="selectAllByName" resultType="com.example.ncre_system_idea.pojo.Student">
        select * from student where Name LIKE CONCAT('%', #{name}, '%')
    </select>
    <select id="selectStudentOfExamRoom" resultType="com.example.ncre_system_idea.pojo.Student">
        select * from student where ExamID=#{examID} and ExamRoomID=#{examRoomID}
    </select>
    <select id="checkStudent" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM student WHERE ExamID is NOT NULL AND ExamRoomID IS NULL AND SeatID is NULL
    </select>
    <select id="selectStudentByUsername" resultType="com.example.ncre_system_idea.pojo.Student">
        select * from student where Username=#{username}
    </select>
    <select id="getIsSignUp" resultType="java.lang.String">
        select examID from student where Username=#{username}
    </select>
    <select id="selectSingUpOverStudent" resultMap="selectSingUpOverStudentMap">
        select * from student where Username=#{username}
    </select>
    <resultMap id="selectSingUpOverStudentMap" type="com.example.ncre_system_idea.pojo.Student">
        <id property="studentID" column="StudentID"></id>
        <result property="name" column="Name"></result>
        <result property="gender" column="Gender"></result>
        <result property="age" column="Age"></result>
        <result property="phoneNumber" column="PhoneNumber"></result>
        <result property="email" column="Email"></result>
        <result property="examID" column="ExamID"></result>
        <result property="examRoomID" column="ExamRoomID"></result>
        <result property="seatID" column="SeatID"></result>
        <result property="username" column="Username"></result>
        <association property="exam" column="ExamID" select="selectExam" javaType="com.example.ncre_system_idea.pojo.Exam"></association>
        <association property="examRoom" column="ExamRoomID" select="selectExamRoom" javaType="com.example.ncre_system_idea.pojo.ExamRoom">
        </association>
    </resultMap>
    <select id="selectExam" resultType="com.example.ncre_system_idea.pojo.Exam">
        select * from exam where ExamID=#{ExamID}
    </select>
    <select id="selectExamRoom" resultType="com.example.ncre_system_idea.pojo.ExamRoom">
        select * from examroom where ExamRoomID=#{ExamRoomID}
    </select>
</mapper>